sudo ip netns add hostA
sudo ip netns add hostB
sudo ip netns add router
sudo ip netns exec hostA ip link set lo up
sudo ip netns exec hostB ip link set lo up
sudo ip netns exec router ip link set lo up
sudo ip link add vethA type veth peer name vethAR
sudo ip link add vethB type veth peer name vethBR
sudo ip link set vethA netns hostA
sudo ip link set vethAR netns router
sudo ip link set vethB netns hostB
sudo ip link set vethBR netns router
sudo ip netns exec hostA ip addr add 10.0.1.2/24 dev vethA
sudo ip netns exec router ip addr add 10.0.1.1/24 dev vethAR
sudo ip netns exec hostB ip addr add 10.0.2.2/24 dev vethB
sudo ip netns exec router ip addr add 10.0.2.1/24 dev vethBR
sudo ip netns exec hostA ip link set vethA up
sudo ip netns exec hostB ip link set vethB up
sudo ip netns exec router ip link set vethAR up
sudo ip netns exec router ip link set vethBR up
sudo ip netns exec hostA ping -c 3 10.0.1.1
sudo ip netns exec hostB ping -c 3 10.0.2.1
sudo ip netns exec hostA ip route
sudo ip netns exec hostB ip route
sudo ip netns exec router ip route
sudo ip netns exec router sysctl -w net.ipv4.ip_forward=1
sudo ip netns exec router sysctl net.ipv4.ip_forward
sudo ip netns exec hostA ip route add 10.0.2.0/24 via 10.0.1.1
sudo ip netns exec hostB ip route add 10.0.1.0/24 via 10.0.2.1
sudo ip netns exec hostA ip route
sudo ip netns exec hostB ip route
sudo ip netns exec router ip route
sudo ip netns exec hostA ping -c 4 10.0.2.2
sudo ip netns exec hostB ping -c 4 10.0.1.2
sudo ip netns exec hostA ping -c 4 10.0.2.2
sudo ip netns exec hostA ip route del 10.0.2.0/24 via 10.0.1.1
sudo ip netns exec hostA ping -c 4 10.0.2.2
sudo ip netns exec hostA ip route add 10.0.2.0/24 via 10.0.1.1
sudo ip netns exec hostA ping -c 3 10.0.2.2
sudo ip netns exec router ip link set vethBR down
sudo ip netns exec hostA ping -c 3 10.0.2.2
sudo ip netns exec router ip link set vethBR up
sudo ip netns exec hostA ping -c 3 10.0.2.2
sudo ip netns exec router tcpdump -i vethBR -n
sudo ip netns exec router sysctl -w net.ipv4.ip_forward=0
sudo ip netns exec hostA ping -c 3 10.0.2.2
sudo ip netns exec hostA ping -c 3 10.0.1.1
sudo ip netns exec router sysctl -w net.ipv4.ip_forward=1
sudo ip netns list
ip link
ls
history
history >> Linux_Network.txt

--------------------------------------------------------------------------------------------
#!/bin/bash

# --- PHASE 1: CLEANUP & PREPARATION ---
echo "--- Cleaning up old namespaces ---"
sudo ip netns del siteA 2>/dev/null
sudo ip netns del siteB 2>/dev/null
sudo ip netns del hostA 2>/dev/null
sudo ip netns del hostB 2>/dev/null

echo "--- Creating Namespaces ---"
sudo ip netns add siteA
sudo ip netns add siteB
sudo ip netns add hostA
sudo ip netns add hostB


# --- PHASE 2: LOCAL INFRASTRUCTURE (BRIDGES & HOSTS) ---
echo "--- Setting up Site A (Bridge & Host) ---"
# Create Bridge brA
sudo ip netns exec siteA ip link add brA type bridge
sudo ip netns exec siteA ip link set brA up

# Create veth pair: hostA <-> siteA
sudo ip link add veth-hostA type veth peer name veth-brA
sudo ip link set veth-hostA netns hostA
sudo ip link set veth-brA netns siteA

# Attach veth-brA to Bridge brA
sudo ip netns exec siteA ip link set veth-brA master brA
sudo ip netns exec siteA ip link set veth-brA up

# Bring up Host A interface
sudo ip netns exec hostA ip link set veth-hostA up

echo "--- Setting up Site B (Bridge & Host) ---"
# Create Bridge brB
sudo ip netns exec siteB ip link add brB type bridge
sudo ip netns exec siteB ip link set brB up

# Create veth pair: hostB <-> siteB
sudo ip link add veth-hostB type veth peer name veth-brB
sudo ip link set veth-hostB netns hostB
sudo ip link set veth-brB netns siteB

# Attach veth-brB to Bridge brB
sudo ip netns exec siteB ip link set veth-brB master brB
sudo ip netns exec siteB ip link set veth-brB up

# Bring up Host B interface
sudo ip netns exec hostB ip link set veth-hostB up


# --- PHASE 3: UNDERLAY NETWORK (CONNECTION BETWEEN SITES) ---
echo "--- Establishing Underlay Connectivity ---"
# Create veth pair for the underlay
sudo ip link add veth-siteA-und type veth peer name veth-siteB-und

# Move interfaces to respective namespaces
sudo ip link set veth-siteA-und netns siteA
sudo ip link set veth-siteB-und netns siteB

# Configure Site A Underlay IP (10.100.0.1/30)
sudo ip netns exec siteA ip addr add 10.100.0.1/30 dev veth-siteA-und
sudo ip netns exec siteA ip link set veth-siteA-und up

# Configure Site B Underlay IP (10.100.0.2/30)
sudo ip netns exec siteB ip addr add 10.100.0.2/30 dev veth-siteB-und
sudo ip netns exec siteB ip link set veth-siteB-und up


# --- PHASE 4: VXLAN CONFIGURATION (THE OVERLAY) ---
echo "--- Configuring VXLAN Tunnels ---"

# Site A VXLAN: VNI 42, sends to Site B (10.100.0.2)
sudo ip netns exec siteA ip link add vxlanA type vxlan id 42 \
  dev veth-siteA-und remote 10.100.0.2 dstport 4789
sudo ip netns exec siteA ip link set vxlanA up
sudo ip netns exec siteA ip link set vxlanA master brA

# Site B VXLAN: VNI 42, sends to Site A (10.100.0.1)
sudo ip netns exec siteB ip link add vxlanB type vxlan id 42 \
  dev veth-siteB-und remote 10.100.0.1 dstport 4789
sudo ip netns exec siteB ip link set vxlanB up
sudo ip netns exec siteB ip link set vxlanB master brB


# --- PHASE 5: OVERLAY IPS & TESTING ---
echo "--- Configuring Host Overlay IPs ---"

# Host A: 10.200.0.10
# MTU 1450 is used to allow space for VXLAN headers (overhead)
sudo ip netns exec hostA ip link set veth-hostA mtu 1450
sudo ip netns exec hostA ip addr add 10.200.0.10/24 dev veth-hostA

# Host B: 10.200.0.20
sudo ip netns exec hostB ip link set veth-hostB mtu 1450
sudo ip netns exec hostB ip addr add 10.200.0.20/24 dev veth-hostB

echo "--- SETUP COMPLETE ---"